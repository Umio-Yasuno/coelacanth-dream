---
title: "もっとスマートを"
date: 2019-11-25T04:28:59+09:00
draft: false
tags: [ "Hugo", ]
keywords: [ "Hugo", "Theme" ]
categories: [ "Diary", ]
---

おこなったCSSの最適化の詳細とその他更新履歴。  

以前はテキストすべてに text-shadow を適用していたが、  
影の計算というのはコストをかかるもので、このことが原因か、  
「初回入力遅延の最大推定時間」が200〜300ms近くのひどいものになっていた。  

そこで text-shadow をページタイトルのみに適用することにした。  
ブラウン管らしさは減ってしまったが、減り具合に対して使いやすさはぐんと向上してるのだから、  
効率はいいため文句なしだ。  
それに色やブラーの加減といった調節が面倒だったため、性能の問題がなくとも遅かれ早かれ減らしていただろう。  

そして一部要素に transform を追加。  
聞いた所によると、これでブラウザ側がその要素をGPUレイヤーとして認識、処理してくれるとか。  

    transform: translateZ(0px);

のような視覚的には意味のない記述でも  
GPUでやってくれるのはトリックっぽくて好きだが、（pxはいらないかもしれない）  
正直ブラウザ側の最適化とかでやって欲しい気はしなくもない。  
使いすぎるとVRAMを喰うともあったから、そうブラウザで勝手にやるわけにもいかないのだろうか。  

結果、最適化のおかげで初回入力遅延は20ms近くまで削減された。  
![PageSpeed Result](/image/2019/11/25/pagespeed-result.webp)  

地味な所ではCSSのアニメーション部分を別ファイルに分けたり、CSSをpreloadするようにしたり、  
サイトタイトルがページ切替時、一瞬青色（リンクに指定した色）になったりするのを直接スタイル指定することで回避したりした。  

最適化以外では、Tags と Categories を footer に追加した。  
一覧もある程度は整備してある。  
ただ Tags は量が多く、表示時に少しもたつくため、ページ分割した方がいいかもしれない。  

 ~~もうほぼ完成したため、公開してもいいかもしれないが、  
やっぱり細かいところがめんどくさい。~~

ある程度整えてからGithubに公開してみた。  
<https://github.com/Umio-Yasuno/crt-theme-hugo>  
公式への登録?は一切考えていない。  
そこまでのクオリティではないし、色々とハードルが高そう。  